---
- hosts: otherservers
  become: yes
  tasks:
    - name: update apt cache
      apt: update_cache=yes
    - name: remove apache
      apt: name=apache2 state=absent
    - name: install jdk
      apt: name=openjdk-8-jdk-headless state=present

- hosts: host2
  become: yes
  tasks:
    - name: install postgresql
      apt: name=postgresql update_cache=true state=present
    - name: install postgresql-contrib
      apt: name=postgresql-contrib state=present
    - name: install libpq
      apt: name=libpq-dev state=present
    - name: install python-psycopg2
      apt: name=python-psycopg2 state=present

- hosts: host1
  become: yes
  tasks:
    - name: install tomcat8
      apt: name=tomcat8 state=present
    - name: install tomcat8admin
      apt: name=tomcat8-admin state=present
    - name: install git
      apt: name=git state=present 
    - name: install nodejs
      shell: apt-get install nodejs -y
    - name: install nodejs
      shell: apt-get install npm -y
    - name: create symbolic link
      file:
        src: /usr/bin/nodejs
        dest: /usr/bin/node
        state: link
    - name: clone repository
      git:
        repo: https://1191780@bitbucket.org/martalribeiro/devops_g2_maven.git
        dest: /home/vagrant/devops_g2_maven
    - name: give permission to execute maven wrapper
      file:
        path: /home/vagrant/devops_g2_maven/personalFinanceManagement/mvnw
        mode: "+rwx"
    - name: maven build
      shell:
        cmd: ./mvnw package -Dmaven.test.skip=true
        chdir: /home/vagrant/devops_g2_maven/personalFinanceManagement
    - name: give permission to execute war file
      file:
        path: /home/vagrant/devops_g2_maven/personalFinanceManagement/target/devOpsProject-1.0-SNAPSHOT.war
        mode: "+rwx"
    - name: deploy the war file to tomcat8
      shell:
       cmd: cp devOpsProject-1.0-SNAPSHOT.war /var/lib/tomcat8/webapps
       chdir: /home/vagrant/devops_g2_maven/personalFinanceManagement/target

