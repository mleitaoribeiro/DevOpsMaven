@startuml
skinparam DefaultFontSize 25
title US007 Sequence Diagram - Happy Case

participant "HTTP Client (Test)"
participant "resultAction:ResultActions"
participant "inputDTO:\ncreateGroupAccountInfoDTO"
participant "postRequest:\nRequestBuilder"
participant "mvcResult :MvcResult"
participant "mvc:MockMvc"
participant "info:createGroupAccountInfoDTO"
participant "AccountDTOAssembler"
participant "createGroupAccountDTO:\nCreateGroupAccountDTO"
participant "restController:\nUS007CreateGroupAccountControllerRest"

== Arrange ==
autonumber
create "inputDTO:\ncreateGroupAccountInfoDTO"
activate "HTTP Client (Test)" #FFBBBB
"HTTP Client (Test)" -> "inputDTO:\ncreateGroupAccountInfoDTO": inputDTO = CreateGroupAccountInfoDTO(groupDescription,\n personEmail, accountDenomination, accountDescription);
"HTTP Client (Test)" -> "HTTP Client (Test)": inputJson = mapToJson(inputDTO)

== Act ==

create "postRequest:\nRequestBuilder"
"HTTP Client (Test)" -> "postRequest:\nRequestBuilder" : postRequest = Post /addGroupAccount {inputJson}
"HTTP Client (Test)" -> "mvc:MockMvc" : resultAction=perform(postRequest)
activate "mvc:MockMvc"  #FFBBBB

autonumber 4.1
"mvc:MockMvc" -> "mvc:MockMvc" : deserialize inputJson
create "info:createGroupAccountInfoDTO"
"mvc:MockMvc"-->"info:createGroupAccountInfoDTO" :create

"mvc:MockMvc"-> "restController:\nUS007CreateGroupAccountControllerRest": addGroupAccount(info)
activate "restController:\nUS007CreateGroupAccountControllerRest" #FFBBBB
autonumber 4.3.1
"restController:\nUS007CreateGroupAccountControllerRest"-> "AccountDTOAssembler":transformToCreateGroupAccountDTO(info)
activate "AccountDTOAssembler" #FFBBBB
autonumber 4.3.1.1
"AccountDTOAssembler" -> "info:createGroupAccountInfoDTO" : groupDescription = getGroupDescription()
activate "info:createGroupAccountInfoDTO" #FFBBBB
"AccountDTOAssembler" -> "info:createGroupAccountInfoDTO" : personEmail = getPersonEmail();
"AccountDTOAssembler" -> "info:createGroupAccountInfoDTO" : accountDescription = getAccountDescription();
"AccountDTOAssembler" -> "info:createGroupAccountInfoDTO" : accountDenomination = getAccountDenomination();
deactivate "info:createGroupAccountInfoDTO"

create "createGroupAccountDTO:\nCreateGroupAccountDTO"
"AccountDTOAssembler" -> "createGroupAccountDTO:\nCreateGroupAccountDTO" : createGroupAccountDTO(personEmail,groupDescription, \naccountDenomination, accountDescription)
activate "createGroupAccountDTO:\nCreateGroupAccountDTO" #FFBBBB
autonumber 4.3.1.5.1
"createGroupAccountDTO:\nCreateGroupAccountDTO" --> "AccountDTOAssembler": createGroupAccountDTO
deactivate "createGroupAccountDTO:\nCreateGroupAccountDTO"
autonumber 4.3.1.6
"AccountDTOAssembler" --> "restController:\nUS007CreateGroupAccountControllerRest" : createGroupAccountDTO
deactivate "AccountDTOAssembler"
autonumber 4.3.1.6.1
"restController:\nUS007CreateGroupAccountControllerRest"->"service:US007CreateGroupAccountService": addAccountDTOGroup(createGroupAccountDTO)
activate "service:US007CreateGroupAccountService" #FFBBBB
autonumber 4.3.1.6.1.1
"service:US007CreateGroupAccountService" --> "restController:\nUS007CreateGroupAccountControllerRest" : accountDTO
deactivate "service:US007CreateGroupAccountService" #FFBBBB

ref over "service:US007CreateGroupAccountService": US007CreateGroupAccountControllerRest_Part2
autonumber 4.3.2
"restController:\nUS007CreateGroupAccountControllerRest"--> "mvc:MockMvc":responseEntity=responseEntity<>(accountDTO,HttpStatus.CREATED)
deactivate "restController:\nUS007CreateGroupAccountControllerRest"
autonumber 4.3.4
"mvc:MockMvc" -> "mvc:MockMvc" : serialize responseEntity

create "resultAction:ResultActions"
"resultAction:ResultActions" <-- "mvc:MockMvc" : create
activate "resultAction:ResultActions" #FFBBBB
deactivate "mvc:MockMvc"

autonumber 5
|||
"HTTP Client (Test)" -> "resultAction:ResultActions" : mvcResult = andReturn()

create "mvcResult :MvcResult"
autonumber 5.1
"resultAction:ResultActions" -> "mvcResult :MvcResult" : create
deactivate "resultAction:ResultActions"
autonumber 6
"HTTP Client (Test)" -> "mvcResult :MvcResult" : response = getResponse()


activate "mvcResult :MvcResult" #FFBBBB
"HTTP Client (Test)" -> "mvcResult :MvcResult" : status = getStatus()
"HTTP Client (Test)" -> "mvcResult :MvcResult" : result = getContentAsString()
deactivate "mvcResult :MvcResult" #FFBBBB

== Assert ==

"HTTP Client (Test)" -> "HTTP Client (Test)" : assertEquals(201, status)
"HTTP Client (Test)" -> "HTTP Client (Test)" : assertEquals(expectedResult, result)

deactivate "service:US007CreateGroupAccountService"

@enduml