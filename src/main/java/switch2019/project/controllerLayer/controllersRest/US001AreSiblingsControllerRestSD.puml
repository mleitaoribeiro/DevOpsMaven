@startuml

skinparam DefaultFontSize 20

title US002.1 Sequence Diagram - Happy Case

participant "test: RestClient"
participant "mvcResult:MvcResult"
participant ":SpringBoot"
participant "restController:US001AreSiblingsControllerRest"
participant "service:US001AreSiblingsService"
participant ":PersonDTOAssembler"
participant "personRepo:PersonRepository"
participant "person1:Person"

== Act ==

autonumber
"test: RestClient" -> ":SpringBoot": GET = /areSiblings\n param(personOneEmail),\n param(personTwoEmail)
activate "test: RestClient" #FFBBBB

autonumber 1.1
activate ":SpringBoot" #FFBBBB
":SpringBoot" -> "restController:US001AreSiblingsControllerRest" : areSiblings(personOneEmail, personTwoEmail)

autonumber 1.1.1
activate "restController:US001AreSiblingsControllerRest" #FFBBBB
"restController:US001AreSiblingsControllerRest" -> ":PersonDTOAssembler": areSiblingsDTO = createAreSiblingsDTO(personOneEmail, personTwoEmail)

autonumber 1.1.1.1
create "areSiblingsDTO:AreSiblingsDTO"
activate ":PersonDTOAssembler" #FFBBBB
":PersonDTOAssembler" -> "areSiblingsDTO:AreSiblingsDTO":  new AreSiblingsDTO(personOneEmail, personTwoEmail)
deactivate ":PersonDTOAssembler"

autonumber 1.1.2
"restController:US001AreSiblingsControllerRest" -> "service:US001AreSiblingsService": areSiblings = areSiblings(areSiblingsDTO)
activate "service:US001AreSiblingsService" #FFBBBB

autonumber 1.1.2.1
"service:US001AreSiblingsService" -> "personRepo:PersonRepository" : person1 = findPersonByEmail(personOneEmail)
activate "personRepo:PersonRepository" #FFBBBB
deactivate "personRepo:PersonRepository"

"service:US001AreSiblingsService" -> "personRepo:PersonRepository" : person2 = findPersonByEmail(personTwoEmail)
activate "personRepo:PersonRepository" #FFBBBB
deactivate "personRepo:PersonRepository"

"service:US001AreSiblingsService" -> "person1:Person" : validSibling = isSibling(person2)
activate "person1:Person" #FFBBBB

autonumber 1.1.2.3.1
"person1:Person" -> "person1:Person" :  personExistsOnSiblingsList(person2)
"person1:Person" -> "person1:Person" :  checkSameFather(person2)
"person1:Person" -> "person1:Person" :  checkSameMother(person2)

deactivate "person1:Person"
deactivate "service:US001AreSiblingsService"

autonumber 1.1.3
"restController:US001AreSiblingsControllerRest" -> ":PersonDTOAssembler": siblingsDTO = createSiblingsDTO(areSiblings)
activate ":PersonDTOAssembler" #FFBBBB
create "siblingsDTO:SiblingsDTO"

autonumber 1.1.3.1
":PersonDTOAssembler" -> "siblingsDTO:SiblingsDTO": new SiblingsDTO(areSiblings)
deactivate ":PersonDTOAssembler"

autonumber 1.4
"restController:US001AreSiblingsControllerRest" -> ":SpringBoot": responseEntity(siblingsDTO, HttpStatus.OK)
deactivate "restController:US001AreSiblingsControllerRest"

":SpringBoot" -> "test: RestClient" : mvcResult
deactivate ":SpringBoot"

"test: RestClient" -> "mvcResult:MvcResult" : status = getResponse().getStatus
activate "mvcResult:MvcResult" #FFBBBB
deactivate "mvcResult:MvcResult"

"test: RestClient" -> "mvcResult:MvcResult" : result = getResponse().getContentAsString()
activate "mvcResult:MvcResult" #FFBBBB
deactivate "mvcResult:MvcResult"

== Assert ==
"test: RestClient" -> "test: RestClient" : assertEquals(200, status)
"test: RestClient" -> "test: RestClient" : assertEquals(expectedResult, result)
deactivate "test: RestClient"

@enduml

